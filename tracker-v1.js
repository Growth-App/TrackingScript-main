const referralSource=document.referrer;function getParameterByName(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");let r=RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),a=r.exec(t);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null}const searchQuery=getParameterByName("q",referralSource),urlParams=new URLSearchParams(referralSource),searchEngine=urlParams.get("utm_source");let paidKeywords;"google"===searchEngine&&(paidKeywords=urlParams.get("utm_term"));const isDirectTraffic=""===referralSource||referralSource.startsWith(window.location.origin),referrer=referralSource.toLowerCase();function getURLParameters(e){let t=e.split("?");if(t?.length===1)return{};let r=t[1],a={},n=r.split("&");return n.forEach(e=>{let[t,r]=e.split("=");a[t]=decodeURIComponent(r)}),a}referrer.includes("facebook.com")||referrer.includes("x.com")||referrer.includes("instagram.com");const currentURL=window.location.href,campaignParameters=getURLParameters(currentURL),utmSource=campaignParameters.utm_source,utmMedium=campaignParameters.utm_medium,utmCampaign=campaignParameters.utm_campaign,utmTerm=campaignParameters.utm_term,utmContent=campaignParameters.utm_content;let timeSpentSeconds=0;function getCurrentTime(){return new Date().getTime()}var startTime=getCurrentTime();function calculateTimeSpent(){return timeSpentSeconds=Math.floor((getCurrentTime()-startTime)/1e3)}function logTimeSpent(){timeSpentSeconds=calculateTimeSpent()}window.addEventListener("beforeunload",function(){logTimeSpent()});let hasInteracted=!1;function trackInteraction(){hasInteracted=!0}function trackExit(){}document.addEventListener("DOMContentLoaded",()=>{document.addEventListener("click",trackInteraction),window.addEventListener("beforeunload",trackExit)});let navigationPaths=[];function trackNavigationPaths(){navigationPaths.push(window.location.href)}trackNavigationPaths();let deadClickCount=0,deadClicksArray=[];function trackDeadClicks(e){let t="a"===e.target.tagName.toLowerCase(),r=e.target.closest("[data-action]");if(!t&&!r){deadClickCount++;let a={target:e.target,timestamp:new Date().toISOString()};deadClicksArray.push(a)}}document.body.addEventListener("click",trackDeadClicks);let scrollDepthPercentage=0,lastScrollTop=0;const throttleTime=100,dynamicThresholdPercentage=.2;let excessiveScrollArray=[];function throttle(e,t){let r=null;return function(){r||(r=setTimeout(()=>{r=null,e.call(this,...arguments)},t))}}function handleScrollEvents(){let e=window.pageYOffset||document.documentElement.scrollTop,t=window.innerHeight,r=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight),a=+(e/(r-t)*100).toFixed(2);scrollDepthPercentage=Math.max(scrollDepthPercentage,a);let n=e>lastScrollTop?"down":"up",i=Math.abs(e-lastScrollTop);i>.2*r&&excessiveScrollArray.push({scrollDistance:i,scrollDirection:n}),lastScrollTop=e}window.addEventListener("scroll",throttle(handleScrollEvents,100));const rageClickThreshold=5;let clickCount=0,lastClickTime=0,rageClicks=[];document.addEventListener("click",function(e){let t=new Date().getTime(),r=t-lastClickTime;r<=1e3?clickCount++:(clickCount=1,rageClicks=[]),lastClickTime=t,clickCount>=5&&rageClicks.push({target:e.target.tagName.toLowerCase(),time:new Date().toISOString(),details:e.target.dataset})});let errorClicks=[];function handleDocumentClick(e){let t=e.target;function r(e){errorClicks.push({target:t,error:e.error?e.error.message:"Unknown error",timestamp:new Date().toISOString()}),console.log(errorClicks),window.removeEventListener("error",r)}window.addEventListener("error",r)}document.addEventListener("click",handleDocumentClick);let sessionCount=localStorage.getItem("sessionCount");sessionCount=sessionCount?parseInt(sessionCount)+1:1,localStorage.setItem("sessionCount",sessionCount);let formDataArray=[];document.addEventListener("submit",function(e){let t=e.target;if(t&&"FORM"===t.tagName){let r=new FormData(t),a={};for(let[n,i]of r.entries())a[n]=i;formDataArray.push(a)}});let trackVideoEventData=function e(t,r,a){return{videoId:t,eventType:r,timestamp:a}};function attachVideoEventListeners(){let e=document.querySelectorAll("video");e.forEach(e=>{e.addEventListener("play",()=>{trackVideoEventEventData(e.id,"play",Date.now())}),e.addEventListener("pause",()=>{trackVideoEventEventData(e.id,"pause",Date.now())}),e.addEventListener("ended",()=>{trackVideoEventEventData(e.id,"ended",Date.now())}),e.addEventListener("timeupdate",()=>{})})}document.addEventListener("DOMContentLoaded",()=>{attachVideoEventListeners()});const downloadEventData=[];function trackDownloadEvent(e){let t={fileName:e,timestamp:new Date().toISOString()};downloadEventData.push(t)}document.addEventListener("DOMContentLoaded",()=>{let e=document.querySelectorAll("a[data-download]");e.forEach(e=>{e.addEventListener("click",t=>{let r=e.getAttribute("data-download");trackDownloadEvent(r)})})});const clickEvents=[];function trackClickOrTap(e){let t={targetElement:e.target.tagName,coordinates:{x:e.pageX,y:e.pageY}};clickEvents.push(t)}function logClickEvents(){}document.addEventListener("click",trackClickOrTap),document.addEventListener("touchstart",trackClickOrTap),logClickEvents();let lastInteractionTime=null,timeSinceLastInteraction=null;function trackInteractions(e){let t=Date.now();lastInteractionTime&&(timeSinceLastInteraction=t-lastInteractionTime),lastInteractionTime=t}function trackClick(e){let t=e.target;t.tagName.toLowerCase(),t.innerText||t.alt||t.src}document.addEventListener("click",trackInteractions),document.addEventListener("click",trackClick);const hoveredElements=[];function trackMouseHover(e){let t={tagName:e.target.tagName,className:e.target.className,id:e.target.id};hoveredElements.push(t)}document.addEventListener("mouseover",trackMouseHover);let pageViewsData=[];function trackPageViews(){let e=window.location.pathname,t=localStorage.getItem(e);t?(t=parseInt(t)+1,localStorage.setItem(e,t.toString())):localStorage.setItem(e,"1"),pageViewsData.push({page:e,views:localStorage.getItem(e)})}trackPageViews();let timeToFirstByte=null;function trackTTFB(){if(window.performance&&window.PerformanceNavigationTiming){let e=window.PerformanceNavigationTiming;timeToFirstByte=e.responseStart-e.navigationStart}}window.addEventListener("load",trackTTFB);let errMsg=null;window.onerror=function(e){e.includes("404")&&(errMsg=e)};const brokenLinks=[];function detectBrokenLinks(){let e=document.querySelectorAll("a");e.forEach(e=>{let t=e.href;fetch(t).then(e=>{e.ok||e.status>=300&&e.status<400||brokenLinks.push({url:t})}).catch(e=>{brokenLinks.push({url:t,error:e.message})})})}let trafficData={};function trackUserTraffic(){let e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);return trafficData.device_type=e?"Mobile":"Desktop",-1!==navigator.userAgent.indexOf("Firefox")?trafficData.browser_type="Firefox":-1!==navigator.userAgent.indexOf("SamsungBrowser")?trafficData.browser_type="Samsung Internet":-1!==navigator.userAgent.indexOf("Opera")||-1!==navigator.userAgent.indexOf("OPR")?trafficData.browser_type="Opera":-1!==navigator.userAgent.indexOf("Trident")?trafficData.browser_type="Internet Explorer":-1!==navigator.userAgent.indexOf("Edge")?trafficData.browser_type="Edge":-1!==navigator.userAgent.indexOf("Chrome")?trafficData.browser_type="Chrome":-1!==navigator.userAgent.indexOf("Safari")?trafficData.browser_type="Safari":trafficData.browser_type="Unknown",-1!==navigator.userAgent.indexOf("Win")?trafficData.operating_system="Windows":-1!==navigator.userAgent.indexOf("Mac")?trafficData.operating_system="MacOS":-1!==navigator.userAgent.indexOf("X11")?trafficData.operating_system="UNIX":-1!==navigator.userAgent.indexOf("Linux")?trafficData.operating_system="Linux":trafficData.operating_system="Unknown",{"device type":`${trafficData?.device_type}`,"browser type":`${trafficData?.browser_type}`,"operating system":`${trafficData?.operating_system}`}}function generateUniqueID(){return`uid-${new Date().getTime()}-${Math.random().toString(36).substr(2,9)}`}function getUserBrowserID(){let e=localStorage.getItem("browserID");return e||(e=generateUniqueID(),localStorage.setItem("browserID",e)),e}trackUserTraffic();const browserID=getUserBrowserID();let isRunning=!1;const runScriptonLoad=async()=>{let e={project_id:GrowthApp_ProjectId,apikey:GrowthAPP_ApiKey,userSessionId:browserID,metrics:{data:[{category:"Traffic Sources",params:{"referral sources":`${referralSource}`,"organic search keywords":`${searchQuery}`,"paid search keywords":`${paidKeywords}`,"direct traffic":`${isDirectTraffic}`,"social media source":`${referrer}`,"campaign tracking parameters":`${utmSource}, ${utmMedium}, ${utmCampaign}, ${utmTerm}, ${utmContent}`}},{category:"User Demographics",params:{"device type":`${trafficData?.device_type}`,"browser type":`${trafficData?.browser_type}`,"operating system":`${trafficData?.operating_system}`,"geographic location":`${trafficData?.geographic_location}`}},{category:"User Behavior",params:{"time spent on the website":timeSpentSeconds,"bounce rate":hasInteracted,"exit rate":hasInteracted,"navigation path":navigationPaths,"scroll depth":scrollDepthPercentage,"dead clicks":deadClicksArray,"excessive scroll":excessiveScrollArray,"rage click":rageClicks,"error click":errorClicks,"clicks and taps":clickEvents,hover:hoveredElements,"page views":pageViewsData,"time to first byte":`${timeToFirstByte} milliseconds`,"broken links":brokenLinks}},]}};if(!isRunning){isRunning=!0;try{let t=await fetch("https://growthapp-backend-c991.onrender.com/api/data/track-traffic",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});await t.json()}catch(r){console.error(r)}finally{isRunning=!1}}};setInterval(runScriptonLoad,3e3),window.addEventListener("load",function(){runScriptonLoad()});